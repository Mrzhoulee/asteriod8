<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asteroid Teams Media Studio</title>
  <style>
    body {
      background-color: antiquewhite;
      font-family: "Montserrat", sans-serif;
      margin: 0;
      height: 100vh;
    }

 input {
  display: inline-block;
  vertical-align: 50px /* Optional: aligns elements vertically */
}

label {
  margin-right: 5px; /* Optional: adds spacing between label and input */
}


    .upload-btn {
      width: 90px;
      height: 40px;
      background-color: coral;
      color: black;
      border-radius: 10%;
      transition: ease-in 0.5s;
    }

    .upload-btn:hover {
      width: 140px;
      height: 90px;
      background-color: lightsalmon;
      font-size: large;
    }

    .bar {
      height: 50px;
      width: 500px;
      background-color: grey;
      position: relative;
    }

    .progress {
      background: linear-gradient(12deg, red, blue);
      position: relative;
      width: 0;
    }


.inline-container h3,
  .inline-container input {
    display: inline-block;
    vertical-align: middle; /* Align elements vertically */
    margin-right: 10px; /* Add some space between them */
  }


    .alert {
      opacity: 0;
      background-color: coral;
    }

    .alertBox {
      background-color: lightcoral;
      width: 500px;
      height: 100px;
      visibility: hidden;
      border-radius: 10%;
      text-align: center;
    }


    .google-sign-in{
      display: block;
    }
    .ht5 {
      background-color: lightcoral;
      width: 800px;
      height: 100px;
      display:none;
      border-radius: 10%;
      text-align: center;
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      /* Allow clicks to pass through the canvas */
    }


    @media only screen and (max-width:1200px){
      .hellothere{
      position: absolute;
      top: 400px;
      left: 180px;
      }
    }
  </style>
</head>

<body>
<div class="hellothere">
  <div style="position: absolute; top: 0px; left: 90px;">
    <a href="index.html"><button style="width: 200px !important; height: 45px !important; font-size: large; border-radius: 10%; background-color: black; color: coral;">Back</button></a>
  </div>
</div>
    <div style="position: absolute; top: 0; right: 90px; ">


<div style="color: black">
    <button style="background-color: white;" id="google-sign-in"><span id="gcm" style="font-size: medium; color: black;"><font color="black">Continue With
        <i class="fa-brands fa-google"></i> </font></span></button>

</div>

  </div>
<center>
  <h1>Asteroid Teams Studio</h1>
  <h2>Upload Media</h2>

  <form id="uploadForm" class="formUpload">
    <div id="referralBadge" style="display: none; background: #00ff88; color: black; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-weight: bold; text-align: center;">
  âœ¨ Referral Active: You are eligible for a Feature!
</div>
    <span class="fileText"></span>
    <input type="text" id="title" placeholder="Enter Title" required>
    <input type="file" class="inputFile" id="fileInp" accept="audio/mpeg" required />
    <input type="text" id="album" placeholder="Enter your custom Album" required>
    <input type="text" id="artist" placeholder="Enter the Song Artist" class="text" required>
    <center>
    <button id="btn" class="upload-btn" type="button"><b>Upload</b></button>
    <button id="Boostpost" class="upload-btn" type="button"><b>BOOST POST</b></button>
    </center>
<div class="inline-container">
  <input type="checkbox" id="agreement">
  <label for="agreement">
    I confirm that I am the rightful owner of <span id="titlelol"></span>, 
    or have full legal rights to upload it. 
    If I do not, I accept all liability and Asteroid may remove this content 
    and suspend my account.
  </label>
</div>

  </center>
  </form>

<center>
  <div class="alertBox" id="alertBox">
    <h1><b>Your Song is being uploaded, Please wait...</b></h1>
   
  </div>
  <div class="alertBox" id="alt1">
    <h1><b>Please fill out the  song information</b></h1>
  </div>

  <div class="alertBox" id="ooaa">
    <h1><b>Your Song is Successfully uploaded!</b></h1>
  </div>
    <div class="alertBox" id="alt5">
    <h1><b>The agreement checkbox is required.</b></h1>
  </div>

    <div class="ht5" id="alt2">
    <h1><b>If your song is a single then enter "Singles" in the album form instead of leaving it blank. </b></h1>
  </div>
<div style="text-align: center !important;">
    <h1>Uploading Guide</h1>
  <font face="Montserrat">
  1. Enter your Song Title
  <br>

  2. Enter your Artist names
  <br>

  3. Enter your Album, if it's a single then just enter Single
  <br>

  4. Make sure you're signed in and please also tick the agreement box
  <br>
  
  5. Click Upload then you're done!
</font>
</div>
  </div>
  <div class="bar">
    <div class="progress"></div>
  </div>


</center>
  <canvas id="can"></canvas>


  <script>
    const button = document.getElementById('btn')
    button.addEventListener('click', () => {
      let progress = document.getElementById("progress");
      const interval = setInterval(() => {
        if (progress = 100) {
          clearInterval(interval);
        } else {
          progress += 5;
          progressBar.style.width = progress + '%';
        }
      }, 1000);

    });
  </script>




  <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
<script type="module">
    // 1. Firebase SDK Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref as ref2, set, update, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getStorage, getDownloadURL, uploadBytes, ref } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    // 2. Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAAvcxcXXNezL5Jip4A9WMkv_r5fpmsDoY",
      authDomain: "asteroid-cdc13.firebaseapp.com",
      databaseURL: "https://asteroid-cdc13-default-rtdb.firebaseio.com",
      projectId: "asteroid-cdc13",
      storageBucket: "asteroid-cdc13.appspot.com",
      messagingSenderId: "793353824502",
      appId: "1:793353824502:web:3ac24821911d14773ba4d7"
    };

    // Initialize Services
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const database = getDatabase(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const jsConfetti = new JSConfetti();

    // --- 3. STRICT REFERRAL & POPUP LOGIC ---
    // Only display the feature popup if the URL matches the specific campaign
    function initReferralSystem() {
        const urlParams = new URLSearchParams(window.location.search);
        const refParam = urlParams.get('ref');
        const byParam = urlParams.get('by'); // Tracks the specific artist who shared it
        const VALID_CODE = "ARTISTSOFFEB26";

        if (refParam === VALID_CODE) {
            localStorage.setItem('referralId', VALID_CODE);
            if (byParam) localStorage.setItem('invitedBy', byParam);
            
            // Display the Feature Badge/Popup
            const badge = document.getElementById('referralBadge');
            if (badge) badge.style.display = 'block';
        } else {
            // Optional: If they land without the code, check if it was previously saved
            if (localStorage.getItem('referralId') !== VALID_CODE) {
                localStorage.removeItem('referralId');
                localStorage.removeItem('invitedBy');
            }
        }
    }

    // --- 4. SHARING LINK GENERATION ---
    // Creates a link for the current artist to share with others
    function generateArtistShareLink() {
        const fullName = localStorage.getItem("fullName") || "Artist";
        const email = localStorage.getItem("email");
        
        if (email) {
            const cleanName = fullName.replace(/\s+/g, '_'); // "John Doe" -> "John_Doe"
            const shareLink = `https://asteroid8.net/?ref=ARTISTSOFFEB26&by=${cleanName}`;
            
            const shareInput = document.getElementById("shareLinkInput");
            if (shareInput) shareInput.value = shareLink;
        }
    }

    // --- 5. GOOGLE SIGN-IN ---
    document.getElementById("google-sign-in").addEventListener("click", () => {
        signInWithPopup(auth, provider).then((result) => {
            const user = result.user;
            localStorage.setItem("email", user.email);
            localStorage.setItem("fullName", user.displayName);
            
            document.getElementById("gcm").innerHTML = user.displayName;
            generateArtistShareLink(); // Update share link once logged in
        }).catch(err => console.error("Auth Error:", err));
    });

    // --- 6. UPLOAD & DATA PACKAGING ---
    const btn = document.getElementById("btn");
    btn.addEventListener('click', async () => {
        const fileInp = document.getElementById("fileInp").files;
        const album = document.getElementById("album").value;
        const title = document.getElementById("title").value;
        const artist = document.getElementById("artist").value;
        const agreement = document.getElementById("agreement");
        const email = localStorage.getItem("email");

        // UI Alerts
        const alt1 = document.getElementById("alt1");
        const alt5 = document.getElementById("alt5");
        alt1.style.visibility = "hidden";
        alt5.style.visibility = "hidden";

        // Requirement Checks
        if (!email) {
            alt5.style.visibility = "visible";
            alt5.innerHTML = "<h2>Login required to be featured.</h2>";
            return;
        }
        if (!agreement.checked) {
            alt5.style.visibility = "visible";
            alt5.innerHTML = "<h2>Check the ownership agreement.</h2>";
            return;
        }
        if (!artist || !title || fileInp.length === 0) {
            alt1.style.visibility = "visible";
            return;
        }

        // Prepare Referral Metadata
        const campaign = localStorage.getItem('referralId') || "organic";
        const referrer = localStorage.getItem('invitedBy') || "none";
        const safeEmail = email.replace(/\./g, ',');

        // Log Agreement in Database
        set(ref2(database, 'agreements/' + safeEmail), {
            email: email,
            agreement: true,
            songtitle: title,
            campaign: campaign,
            referrer: referrer,
            timestamp: Date.now()
        });

        document.getElementById("alertBox").style.visibility = "visible";
        jsConfetti.addConfetti();

        // Process Uploads
        for (let i = 0; i < fileInp.length; i++) {
            const storagePath = `${album}/${title}/${artist}/${fileInp[i].name}`;
            const uploadTask = await uploadBytes(ref(storage, storagePath), fileInp[i]);
            const downloadURL = await getDownloadURL(uploadTask.ref);

            // PACKAGE EVERYTHING FOR THE "SONGS" NODE
            let uploadPackage = {};
            uploadPackage[title] = {};
            uploadPackage[title][album] = {};
            uploadPackage[title][album][artist] = {
                fileInp: downloadURL,
                title: title,
                album: album,
                artist: artist,
                uploaderEmail: email,       // Identity
                referralCode: campaign,     // ARTISTSOFFEB26 check
                invitedBy: referrer,        // Viral tracking
                timestamp: Date.now()
            };

            update(ref2(database, "SONGS"), uploadPackage);
        }

        // Success UI
        document.getElementById("ooaa").style.visibility = "visible";
        document.getElementById("alertBox").style.visibility = "hidden";
        
        // Clear campaign data after successful use
        localStorage.removeItem('referralId');
        localStorage.removeItem('invitedBy');
    });

    // Copy Button for Sharing Link
    document.getElementById("copyBtn")?.addEventListener("click", () => {
        const link = document.getElementById("shareLinkInput");
        link.select();
        navigator.clipboard.writeText(link.value);
        alert("Personalized Referral Link Copied!");
    });

    // Run on startup
    initReferralSystem();
    generateArtistShareLink();

</script>
</body>


</html>







