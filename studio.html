<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asteroid Teams Media Studio</title>
  <style>
    body {
      background-color: antiquewhite;
      font-family: "Montserrat", sans-serif;
      margin: 0;
      height: 100vh;
    }

 input {
  display: inline-block;
  vertical-align: 50px /* Optional: aligns elements vertically */
}

label {
  margin-right: 5px; /* Optional: adds spacing between label and input */
}


    .upload-btn {
      width: 90px;
      height: 40px;
      background-color: coral;
      color: black;
      border-radius: 10%;
      transition: ease-in 0.5s;
    }

    .upload-btn:hover {
      width: 140px;
      height: 90px;
      background-color: lightsalmon;
      font-size: large;
    }

    .bar {
      height: 50px;
      width: 500px;
      background-color: grey;
      position: relative;
    }

    .progress {
      background: linear-gradient(12deg, red, blue);
      position: relative;
      width: 0;
    }


.inline-container h3,
  .inline-container input {
    display: inline-block;
    vertical-align: middle; /* Align elements vertically */
    margin-right: 10px; /* Add some space between them */
  }


    .alert {
      opacity: 0;
      background-color: coral;
    }

    .alertBox {
      background-color: lightcoral;
      width: 500px;
      height: 100px;
      visibility: hidden;
      border-radius: 10%;
      text-align: center;
    }


    .google-sign-in{
      display: block;
    }
    .ht5 {
      background-color: lightcoral;
      width: 800px;
      height: 100px;
      display:none;
      border-radius: 10%;
      text-align: center;
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      /* Allow clicks to pass through the canvas */
    }


    @media only screen and (max-width:1200px){
      .hellothere{
      position: absolute;
      top: 400px;
      left: 180px;
      }
    }
  </style>
</head>

<body>
<div class="hellothere">
  <div style="position: absolute; top: 0px; left: 90px;">
    <a href="index.html"><button style="width: 200px !important; height: 45px !important; font-size: large; border-radius: 10%; background-color: black; color: coral;">Back</button></a>
  </div>
</div>
    <div style="position: absolute; top: 0; right: 90px; ">


<div style="color: black">
    <button style="background-color: white;" id="google-sign-in"><span id="gcm" style="font-size: medium; color: black;"><font color="black">Continue With
        <i class="fa-brands fa-google"></i> </font></span></button>

</div>

  </div>
<center>
  <h1>Asteroid Teams Studio</h1>
  <h2>Upload Media</h2>

  <form id="uploadForm" class="formUpload">
    <span class="fileText"></span>
    <input type="text" id="title" placeholder="Enter Title" required>
    <input type="file" class="inputFile" id="fileInp" accept="audio/mpeg" required />
    <input type="text" id="album" placeholder="Enter your custom Album" required>
    <input type="text" id="artist" placeholder="Enter the Song Artist" class="text" required>
    <center>
    <button id="btn" class="upload-btn" type="button"><b>Upload</b></button>
    <button id="Boostpost" class="upload-btn" type="button"><b>BOOST POST</b></button>
    </center>
<div class="inline-container">
  <input type="checkbox" id="agreement">
  <label for="agreement">
    I confirm that I am the rightful owner of <span id="titlelol"></span>, 
    or have full legal rights to upload it. 
    If I do not, I accept all liability and Asteroid may remove this content 
    and suspend my account.
  </label>
</div>

  </center>
  </form>

<center>
  <div class="alertBox" id="alertBox">
    <h1><b>Your Song is being uploaded, Please wait...</b></h1>
   
  </div>
  <div class="alertBox" id="alt1">
    <h1><b>Please fill out the  song information</b></h1>
  </div>

  <div class="alertBox" id="ooaa">
    <h1><b>Your Song is Successfully uploaded!</b></h1>
  </div>
    <div class="alertBox" id="alt5">
    <h1><b>The agreement checkbox is required.</b></h1>
  </div>

    <div class="ht5" id="alt2">
    <h1><b>If your song is a single then enter "Singles" in the album form instead of leaving it blank. </b></h1>
  </div>
<div style="text-align: center !important;">
    <h1>Uploading Guide</h1>
  <font face="Montserrat">
  1. Enter your Song Title
  <br>

  2. Enter your Artist names
  <br>

  3. Enter your Album, if it's a single then just enter Single
  <br>

  4. Make sure you're signed in and please also tick the agreement box
  <br>
  
  5. Click Upload then you're done!
</font>
</div>
  </div>
  <div class="bar">
    <div class="progress"></div>
  </div>


</center>
  <canvas id="can"></canvas>


  <script>
    const button = document.getElementById('btn')
    button.addEventListener('click', () => {
      let progress = document.getElementById("progress");
      const interval = setInterval(() => {
        if (progress = 100) {
          clearInterval(interval);
        } else {
          progress += 5;
          progressBar.style.width = progress + '%';
        }
      }, 1000);

    });
  </script>




  <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";
    import { getDatabase, ref as ref2, set, update, onValue, push } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getStorage, getDownloadURL, uploadBytes, ref } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configurationx
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyAAvcxcXXNezL5Jip4A9WMkv_r5fpmsDoY",
      authDomain: "asteroid-cdc13.firebaseapp.com",
      databaseURL: "https://asteroid-cdc13-default-rtdb.firebaseio.com",
      projectId: "asteroid-cdc13",
      storageBucket: "asteroid-cdc13.appspot.com",
      messagingSenderId: "793353824502",
      appId: "1:793353824502:web:3ac24821911d14773ba4d7",
      measurementId: "G-GV72TMNNGR"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const storage = getStorage(app);
    const database = getDatabase(app);
    let users = localStorage.getItem("users");



            const auth = getAuth(app);
            const provider = new GoogleAuthProvider();

       document.getElementById("google-sign-in").addEventListener("click", (e) => {
              console.log("gcm_ready");
              signInWithPopup(auth, provider)
                .then((result) => {
                  // This gives you a Google Access Token. You can use it to access the Google API.
                  const credential = GoogleAuthProvider.credentialFromResult(result);
                  const token = credential.accessToken;
                  // The signed-in user info.
                  const user = result.user;
                  console.log(user)
                  console.log("google-sign-in-clicked")
                  localStorage.setItem("email", user["email"]);
                  localStorage.setItem("CurrentUser", user["email"]);
                  localStorage.setItem("fullName", user["displayName"]);
                  localStorage.setItem("pfp", user.imageUrl);
                  localStorage.setItem("pfp", user.photoURL); // 
                  var fullName = user.displayName;
                  document.getElementById("gcm").innerHTML = fullName;
                  document.getElementById("gcd").innerHTML = fullName;
                  console.log("Photo URL:", user.photoURL);



                  // IdP data available using getAdditionalUserInfo(result)
                  // ...
                }).catch((error) => {
                  // Handle Errors here.
                  const errorCode = error.code;
                  const errorMessage = error.message;
                  // The email of the user's account used.
                  const email = error.customData.email;
                  // The AuthCredential type that was used.
                  const credential = GoogleAuthProvider.credentialFromError(error);
                  // ...
                });
            })
    

    let gaga = {}
    const canvas = document.getElementById('can');
    const jsConfetti = new JSConfetti();
    const boost = document.getElementById("Boostpost");

    const btn = document.getElementById("btn");
    boost.addEventListener('click', () => {
      window.location.href = "boost.html"
    })

    // Ensure canvas is full-screen
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    // getDownloadURL(ref(storage, "1/1/Guns N' Roses - Knockin' On Heaven's Door (Lyrics) (1).mp3"))
    // .then((url)=>{
    //   console.log(url);
    // })


    // localStorage.setItem('a', JSON.stringify({

        let emailty = localStorage.getItem("email");



    onValue(ref2(database, "SONGS/"), (snapshot) => {
      console.log(snapshot.val())
    })
    //   }))
    btn.addEventListener('click', async () => {
            

      const fileInp = document.getElementById("fileInp").files;
      const album = document.getElementById("album").value;
      const title = document.getElementById("title").value;
      const artist = document.getElementById("artist").value;
                  let agreement = document.getElementById("agreement");
          let email = localStorage.getItem("email");

// Case 1: all fields filled but agreement not ticked
      
  const alt1 = document.getElementById("alt1"); // Missing fields
  const alt2 = document.getElementById("alt2"); // Album empty
  const alt5 = document.getElementById("alt5"); // Agreement missing
  
// First, hide all alerts initially
alt1.style.visibility = "hidden";
alt2.style.visibility = "hidden";
alt5.style.visibility = "hidden";

if(!email){
    alt5.style.visibility = "visible";
    alt5.innerHTML = `<center><b><h2>Sign in is required to upload.</h2></b></center>`;
    return;
}

// Check the agreement first
// Check agreement first
if (!agreement.checked) { 
    alt5.style.visibility = "visible";
    alt5.innerHTML = `<center><b><h2>The agreement checkbox is required.</h2></b></center>`;
    return; 
}
if (!artist || !title || fileInp.length === 0) {
    alt1.style.visibility = "visible";
    alt1.innerHTML = `<center><b><h2>Please fill out the song information</h2></b></center>`;
    return;
}

// Check single-album warning (only shows if album is empty but other fields are filled)
if (!album && artist && title && fileInp.length > 0) {
    alt1.style.visibility = "visible";
    alt1.innerHTML = `<center><b><h2>If your song is a single then enter "Singles" in the album form instead of leaving it blank.</h2></b></center>`;
    // ‚ö† no return here, so database will still save
}

// Assume `email` contains the user's email
const safeEmail = email.replace(/\./g, ','); // replace dots with commas

// Everything is valid, save to database
set(ref2(database, 'agreements/' + safeEmail), {
    email: email,
    agreement: true,
    songtitle: title,
    timestamp: Date.now()
});

// If all checks pass, hide all alerts and proceed
alt1.style.visibility = "hidden";
alt2.style.visibility = "hidden";
alt5.style.visibility = "hidden";

// Save agreement info to database







      // ‚úÖ If we got here ‚Üí everything is valid
document.getElementById("btn").disabled = false;
document.getElementById("titlelol").innerText = title;

      console.log("hello");
      // Show alert on button click
      document.getElementById("alertBox").style.visibility = "visible";



      // Add confetti explosion
      jsConfetti.addConfetti({
        emojis: ['üåà', '‚ö°Ô∏è', 'üí•', '‚ú®', 'üí´', 'üå∏'],
      });



      let i = 0;
      while (i < fileInp.length) {
        const response = await uploadBytes(ref(storage, album + "/" + title + "/" + artist + "/" + fileInp[i].name), fileInp[i]);
        const downloadURL = await getDownloadURL(response.ref);

        let gaga = {};
      
        let rec = title + "/" + album + "/" + fileInp[i].name;
        if (rec) {
    console.log("Loading finished");
    console.log(rec);  // Log the stored message
    document.getElementById("ooaa").style.visibility = "visible";
    document.getElementById("alertBox").style.visibility = "hidden";
}
        gaga[title] = {}
        gaga[title][album] = {}
        gaga[title][album][artist] = {
          fileInp: downloadURL,
          title: title,
          album: album,
          artist: artist
        }
        console.log(gaga);
        update(ref2(database, "SONGS"), gaga); 
        i++;
        console.log("cccccc");
      }

     
      
    
  


  
    });
  </script>
</body>


</html>






